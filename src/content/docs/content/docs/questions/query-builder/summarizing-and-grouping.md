---
title: خلاصه‌سازی و گروه‌بندی
summary: یاد بگیرید چطور داده‌ها را در Query builder متابیس خلاصه و گروه‌بندی کنید تا Metricهایی مثل تعداد، جمع و میانگین را روی ابعاد مختلف حساب کنید.
---

<!-- markdownlint-disable-next-line MD025 -->
# خلاصه‌سازی و گروه‌بندی

این صفحه مراحل Summarize و Grouping در [Query builder](./editor.md) را توضیح می‌دهد.

![Summarizing](../images/summarize-step.png)

وقتی سؤالی مثل «چند نفر در هر روز از هفتهٔ گذشته اپ ما را دانلود کرده‌اند؟» می‌پرسیم، در واقع داریم یک **خلاصه** از داده می‌خواهیم. یک خلاصه معمولاً از دو بخش تشکیل می‌شود: یک یا چند _عدد_ که برای‌مان مهم‌اند (در دنیای داده به آن‌ها "Metric" می‌گویند)، و این‌که می‌خواهیم آن عدد را چطور _گروه‌بندی_ یا _Breakout_ کنیم. برای پاسخ به مثال بالا:

- Metric ما تعداد افرادی است که اپ را دانلود کرده‌اند (تعداد ردیف‌ها).
- می‌خواهیم این Metric را بر اساس «هر روز» گروه‌بندی کنیم.
- و می‌خواهیم فقط ردیف‌های مربوط به «هفتهٔ گذشته» را در نظر بگیریم.

دو روش رایج برای خلاصه‌سازی داده‌ها عبارت‌اند از:

- شمارش تعداد ردیف‌های جدول
- محاسبهٔ جمع (Sum) یا میانگین (Average) یک ستون عددی

و در بسیاری از مواقع، بعد از آن Metric را بر اساس یکی از موارد زیر **گروه‌بندی** می‌کنیم:

- زمان
- مکان
- دسته‌بندی (Category)

## Metricهای خلاصه (Summary metrics)

با اضافه‌کردن یک مرحلهٔ Summarize می‌توانید تعیین کنید دادهٔ مرحلهٔ قبل چطور Aggregate شود. می‌توانید یک یا چند Metric انتخاب کنید و به‌صورت اختیاری آن‌ها را بر اساس یک یا چند Dimension (ستون) گروه‌بندی کنید. هنگام انتخاب Metric، می‌توانید از توابع پایه مثل ‎`sum`‎، ‎`average`‎ و ‎`count`‎ استفاده کنید، یا یک Metric ازپیش‌تعریف‌شده توسط ادمین را انتخاب کنید، یا با نوشتن فرمول، یک [عبارت سفارشی](./expressions.md) بسازید.

برخی Metricهای رایج:

- **Count of rows**: تعداد کل ردیف‌های جدول بعد از اعمال فیلترها. اگر جدول `Orders` را نگاه می‌کنید و می‌خواهید بدانید چند سفارش با قیمت بالاتر از ۴۰ ثبت شده، فیلتر «Price greater than 40» را اعمال می‌کنید و بعد گزینهٔ `Count of rows` را انتخاب می‌کنید، چون می‌خواهید متابیس بشمارد چند سفارش با آن فیلتر مطابقت دارند.
- **Sum of …**: جمع همهٔ مقادیر یک ستون مشخص.
- **Average of …**: میانگین همهٔ مقادیر یک ستون.
- **Number of distinct values of…**: تعداد مقادیر یکتای موجود در همهٔ سلول‌های یک ستون. این Metric برای پاسخ به سؤالاتی مثل «ماه گذشته چند _نوع_ محصول متفاوت فروخته شد؟» مفید است (نه این‌که چند عدد در مجموع فروخته شده).
- **Cumulative sum of…**: مجموع تجمعی (Running total) یک ستون. برای مفید بودن این Metric لازم است آن را بر اساس یک ستون تاریخ گروه‌بندی کنید تا روند آن را در طول زمان ببینید.
- **Cumulative count of rows**: مجموع تجمعی تعداد ردیف‌ها در طول زمان. درست مثل `Cumulative sum of…`، برای مفید بودن باید آن را بر حسب یک ستون تاریخ گروه‌بندی کنید.
- **Standard deviation of …**: عددی که نشان می‌دهد مقادیر یک ستون چقدر (به‌صورت مثبت و منفی) از میانگین آن ستون فاصله دارند.
- **Minimum of …**: کوچک‌ترین مقدار موجود در فیلد انتخاب‌شده.
- **Maximum of …**: بزرگ‌ترین مقدار موجود در فیلد انتخاب‌شده.

اگر یک Summarize انجام دهید و بعد Grouping اضافه کنید، می‌توانید پس از آن دوباره هم Summarize کنید. همچنین می‌توانید بین این مراحل، مرحله‌های Filter و/یا Join اضافه کنید. مثلاً در اولین مرحلهٔ Summarize تعداد سفارش‌ها در هر ماه را به‌دست می‌آورید، و در مرحلهٔ Summarize دوم، میانگین تعداد سفارش‌های ماهانه را با انتخاب `Average of…` روی ستون `count` محاسبه می‌کنید.

![Multiple summarize steps](../images/multiple-summarize-steps.png)

همچنین می‌توانید Metricها و Groupingها را در صفحهٔ نتایج و ازطریق سایدبار اضافه کنید: بالای سایدبار جایی است که عدد (Metric) موردنظر را انتخاب می‌کنید و بخش پایین تعیین می‌کند آن عدد چطور گروه‌بندی (Breakout) شود.

اگر ادمین‌ها [Metricهای](../../data-modeling/metrics.md) نام‌گذاری‌شده‌ای مخصوص سازمان شما تعریف کرده باشند، این Metricها در همین Dropdown و زیر بخش **Common Metrics** نمایش داده می‌شوند؛ مثل روش رسمی شرکت برای محاسبهٔ «Revenue».

به‌صورت پیش‌فرض، متابیس تعداد ردیف‌های Aggregate‌شده‌ای را که نمایش می‌دهد به ۱۰٬۰۰۰ ردیف محدود می‌کند. می‌توانید این سقف را با متغیر محیطی [`MB_AGGREGATED_QUERY_ROW_LIMIT`](../../configuring-metabase/environment-variables.md#mb_aggregated_query_row_limit) تغییر دهید.

## گروه‌بندی Metricها

بسته به ستونی که برای Grouping انتخاب می‌کنید، متابیس سعی می‌کند مناسب‌ترین Visualization پیش‌فرض را برای آن خلاصه انتخاب کند. مثلاً اگر ستون تاریخ را به‌عنوان Grouping انتخاب کنید، یک نمودار خطی شبیه تصویر زیر می‌بینید (می‌توانید روی دکمهٔ سبز **Summarize** کلیک کنید تا سایدبار Summarize را ببینید).

![Grouping by a date column](../images/summarize-timeseries.png)

وقتی روی ستونی متفاوت از ستون Grouping فعلی کلیک کنید، Grouping روی ستون جدید اعمال می‌شود. اما اگر بخواهید یک Grouping اضافی _اضافه_ کنید، کافی است روی آیکون + در سمت راست ستون کلیک کنید. برای حذف یک Grouping هم روی آیکون X کلیک کنید.

![Multiple groupings](../images/summarize-timeseries-breakout.png)

بعضی ستون‌ها هنگام Grouping گزینه‌هایی برای تعیین «ریز یا درشت بودن» Grouping در اختیارتان می‌گذارند:

- برای ستون‌های تاریخ/زمان (Datetime)، می‌توانید روی عبارت `by month` کلیک کنید و Grouping را به روز، هفته، ساعت، فصل، سال و غیره تغییر دهید. همچنین می‌توانید چند Breakout روی یک ستون Datetime داشته باشید با Granularityهای متفاوت (مثلاً Group by week و day of week هم‌زمان). برای اطلاعات بیشتر دربارهٔ Group کردن بر اساس هفتهٔ سال، به [Week of year](./expressions/week.md) مراجعه کنید.
- برای ستون‌های عددی مثل سن، متابیس نتایج را به‌صورت خودکار «Bin» می‌کند، بنابراین Metric شما در بازه‌های سنی مثل ۰–۱۰، ۱۱–۲۰، ۲۱–۳۰ و غیره گروه‌بندی می‌شود. درست مثل تاریخ، می‌توانید روی گزینهٔ Bin فعلی کلیک کنید و آن را به تعداد مشخصی Bin تغییر دهید. در حال حاضر نمی‌توانید بازه‌های دلخواه برای Binها تعریف کنید.

  ![Multiple groupings](../images/histogram-bins.png)

  اگر تعداد ثابتی Bin انتخاب کنید، متابیس بازهٔ داده را به همان تعداد بازه‌های هم‌اندازه تقسیم می‌کند. ممکن است برخی بازه‌ها هیچ داده‌ای نداشته باشند و متابیس آن‌ها را نمایش ندهد.
