---
title: "افزودن ستون‌های سفارشی"
description: "ستون‌های سفارشی در متابیس ایجاد کنید تا معیارهای جدید محاسبه کنید یا داده خود را تمیز کنید"
redirect_from:
  - /learn/metabase-basics/getting-started/custom-columns
toc:
  - id: "add-custom-columns"
    title: "افزودن ستون‌های سفارشی"
    level: 1
    href: "#add-custom-columns"
  - id: "add-a-custom-column"
    title: "افزودن یک ستون سفارشی"
    level: 2
    href: "#add-a-custom-column"
  - id: "note-for-sql-experts"
    title: "یادداشت برای متخصصان SQL"
    level: 3
    href: "#note-for-sql-experts"
  - id: "extract-and-combine-columns"
    title: "استخراج و ترکیب ستون‌ها"
    level: 2
    href: "#extract-and-combine-columns"
  - id: "work-with-text"
    title: "کار با متن"
    level: 2
    href: "#work-with-text"
  - id: "work-with-dates"
    title: "کار با تاریخ‌ها"
    level: 2
    href: "#work-with-dates"
  - id: "do-math"
    title: "انجام ریاضی"
    level: 2
    href: "#do-math"
  - id: "add-if-then-logic"
    title: "افزودن منطق if-then"
    level: 2
    href: "#add-if-then-logic"
  - id: "use-custom-columns-to-build-queries-and-charts"
    title: "استفاده از ستون‌های سفارشی برای ساخت پرس‌وجوها و نمودارها"
    level: 2
    href: "#use-custom-columns-to-build-queries-and-charts"
  - id: "next-steps"
    title: "مراحل بعدی"
    level: 2
    href: "#next-steps"
breadcrumbs:
  - title: "خانه"
    href: "../../index.html"
  - title: "شروع کار"
    href: "../../courses/getting-started.html"
---

# افزودن ستون‌های سفارشی

ستون‌های سفارشی در متابیس ایجاد کنید تا معیارهای جدید محاسبه کنید یا داده خود را تمیز کنید

متابیس به شما اجازه ایجاد فیلدهای جدید on the fly با استفاده از اطلاعات از ستون‌های دیگر را می‌دهد. به عنوان مثال، می‌توانید:

- دو ستون را اضافه کنید
- بخشی از یک تاریخ را استخراج کنید
- یک ستون جدید بر اساس شرایط منطقی تعریف کنید

متابیس این ستون‌های مشتق شده جدید را "ستون‌های سفارشی" می‌نامد.

برای ایجاد ستون‌های سفارشی، می‌توانید از [عبارات سفارشی](../../../docs/latest/questions/query-builder/expressions.html) استفاده کنید، که مثل فرمول‌ها در صفحه‌گسترده‌ها، یا توابع در SQL هستند. به عنوان مثال، می‌توانید از تابع [`substring`](../../../docs/latest/questions/query-builder/expressions/substring.html) برای استخراج بخشی از متن استفاده کنید، و از [`case`](../../../docs/latest/questions/query-builder/expressions/case.html) برای تعریف مقادیر بر اساس یک شرط استفاده کنید.

در این آموزش، برخی از رایج‌ترین موارد استفاده برای ستون‌های سفارشی را مرور می‌کنیم. از جدول `Analytic Events` از پایگاه داده نمونه که شامل داده رویداد برای یک محصول تخیلی است استفاده می‌کنیم. مثال‌های ستون سفارشی که می‌توانند برای تحلیل محصول مفید باشند را می‌سازیم.

## افزودن یک ستون سفارشی

یک سؤال query builder جدید بر اساس جدول `Analytic Events` شروع کنید.

برای افزودن یک ستون سفارشی، روی دکمه خاکستری زیر بلوک "Data" کلیک کنید.

ویرایشگر عبارت متابیس را خواهید دید. می‌توانید از میانبرها برای ترکیب یا استخراج داده از ستون‌ها استفاده کنید، یا عبارات خود را بنویسید. قبل از شروع، چند نکته برای توجه:

- از `[]` برای ارجاع به ستون‌ها در ویرایشگر عبارت استفاده کنید، مثل `[Timestamp]`، یا `[Accounts → Timestamp]` برای ستون‌ها از جداول join شده. خوشبختانه، نیاز به تایپ کردن نام کامل ستون (یا براکت‌ها) خود ندارید چون متابیس گزینه‌های autocomplete را همانطور که شروع به تایپ می‌کنید ارائه می‌دهد.
- می‌توانید از عملگرهایی مثل `OR`، `AND`، `<`، `=`، `!=` در عبارات سفارشی استفاده کنید.
- محدودیت‌های پایگاه داده روی برخی عبارات سفارشی وجود دارد. [مستندات ما](../../../docs/latest/questions/query-builder/expressions-list.html#limitations) را برای فهرست کامل بررسی کنید.

### یادداشت برای متخصصان SQL

در SQL، عملیات ستون (مثل `Total + Tax` یا `DateDiff(Created_At, Canceled_at, 'week')`) و تجمیع‌ها (مثل `SUM(Total)` یا `AVG(Quantity)`) هر دو در بند `SELECT` تعریف می‌شوند. در query builder متابیس، این‌ها مراحل پرس‌وجوی مختلف هستند: عملگرها و توابع روی ستون‌ها در بلوک‌های ستون سفارشی تعریف می‌شوند، اما تجمیع‌ها روی یک ستون در یک بلوک Summarize جداگانه تعریف می‌شوند. قادر به استفاده از تجمیع‌هایی مثل `Sum`، `Count` در ستون‌های سفارشی نخواهید بود، اما می‌توانید خلاصه‌های سفارشی را در بلوک Summarize تعریف کنید.

آموزش ما درباره [نحوه خلاصه کردن داده](summarize.html) را برای یادگیری بیشتر بررسی کنید.

## استخراج و ترکیب ستون‌ها

می‌توانید بخش‌هایی از ستون‌های تاریخ یا URL را استخراج کنید، و ستون‌ها را با هم concatenate کنید.

به عنوان مثال، ممکن است علاقه‌مند باشید بدانید فعالیت رویداد چگونه در طول روز توزیع شده است: ساعاتی که مردم بیشتر فعال هستند چیست؟

1. برای افزودن یک ستون سفارشی، روی دکمه خاکستری زیر بلوک "Data" کلیک کنید. می‌توانید یک عبارت اضافه کنید، یا ستون‌ها را استخراج یا ترکیب کنید.
2. در ویرایشگر عبارت زیر **Shortcuts**، **Extract columns** را انتخاب کنید. میانبرهای **Extract** با ستون‌های URL یا timestamp کار می‌کنند. برای ستون‌های URL، می‌توانید انتخاب کنید host، domain، یا subdomain را استخراج کنید. برای ستون‌های timestamp، می‌توانید بخش‌هایی از تاریخ یا زمان را استخراج کنید.
3. ستون `Timestamp` را انتخاب کنید و `Hour of day` را استخراج کنید. ویرایشگر عبارت سفارشی را با عبارت `hour([Timestamp])` در آن خواهید دید. همه آنچه میانبرها انجام می‌دهند prefilling عبارت برای شما است.
4. روی **Done** کلیک کنید تا ستون سفارشی را ذخیره کنید و ویرایشگر را ببندید.
5. نتایج را پیش‌نمایش کنید.

![ساعت روز](../../images/custom-columns/hour-of-day.png)

یک ستون جدید `Hour of day` در نتایج خواهید دید که 0 برای timestampهای بین 12 صبح و 1 صبح، 1 برای timestampهای بین 1 صبح و 2 صبح و غیره دارد.

## کار با متن

می‌توانید از ستون‌های سفارشی برای تمیز کردن، فرمت کردن، یا دستکاری متن استفاده کنید.

به عنوان مثال، URLها در رویدادهای Analytic به شکل `www.piespace.example/<path>` هستند. چون domain برای هر URL یکسان است، منطقی است فقط از بخش `path` برای تحلیل استفاده کنیم. اما میانبرهای [**Extract URL**](#extract-and-combine-columns) فقط می‌توانند host، domain، یا subdomain را استخراج کنند. برای path، نیاز به نوشتن عبارت سفارشی خود دارید:

1. یک ستون سفارشی جدید با کلیک روی **+** در بلوک **Custom column** ایجاد کنید، و در فیلد **Expression**، عبارت را وارد کنید: ```mbql regexextract([Page URL], "/.*") ``` `regexextract` از یک عبارت منظم برای گرفتن بخشی از `Page URL` که با `/` شروع می‌شود استفاده می‌کند. بیشتر درباره عبارت `regexextract` [در مستندات ما](../../../docs/latest/questions/query-builder/expressions/regexextract.html) بخوانید.
2. ستون را `URL Path` نامگذاری کنید و روی **Done** کلیک کنید.
3. نتایج را پیش‌نمایش کنید. ![ستون سفارشی URL](../../images/custom-columns/url-path.png)

توابع متنی مفید دیگر: `replace`، `substring`، `concat`. [توابع String](../../../docs/latest/questions/query-builder/expressions-list.html#string-functions) را برای فهرست کامل ببینید.

## کار با تاریخ‌ها

می‌توانید از عبارات سفارشی تاریخ برای پیدا کردن تفاوت‌ها بین دو تاریخ، افزودن یا کم کردن دوره‌ها، یا استخراج بخش‌هایی از یک تاریخ استفاده کنید.

به عنوان مثال، اگر علاقه‌مند به تفاوت‌های رفتار برای بازدیدکنندگان جدید در مقابل قدیمی هستید، می‌توانید یک ستون ایجاد کنید که شامل چند روز بین ایجاد حساب و یک رویداد گذشته است.

1. یک ستون سفارشی جدید با کلیک روی **+** در بلوک **Custom column** ایجاد کنید، و در فیلد **Expression**، عبارت را وارد کنید: ```mbql datetimeDiff([Account → Created At],[Timestamp], "day") ``` ستون `Created At` در جدول `Account` است، نه جدول `Analytic Events` که به عنوان منبع برای سؤال استفاده می‌شود. اما چون `Account` به جدول `Analytic Events` متصل است (از طریق ستون Account ID)، متابیس می‌تواند از داده از ستون `Account` در سؤال‌ها درباره `Analytic Events` استفاده کند. فقط نیاز به مشخص کردن اینکه ستون از یک جدول مختلف با استفاده از `→` می‌آید دارید. بیشتر درباره عبارت `datetimeDiff` [در مستندات ما](../../../docs/latest/questions/query-builder/expressions/datetimediff.html) بخوانید.
2. ستون را به عنوان `Days since creation` ذخیره کنید (بعداً به این نام ارجاع می‌دهیم).
3. نتایج را پیش‌نمایش کنید. ![روزها از ایجاد](../../images/custom-columns/days-since-creation.png)

توابع تاریخ مفید دیگر: `datetimeAdd`، `convertTimezone`، `now`. [توابع Date](../../../docs/latest/questions/query-builder/expressions-list.html#date-functions) را برای فهرست کامل ببینید.

## انجام ریاضی

می‌توانید از عبارات سفارشی برای عملیات ریاضی معمول با هم ستون‌ها و هم اعداد استفاده کنید: به عنوان مثال، می‌توانید دو ستون را با هم اضافه کنید، یک ستون را در 100 ضرب کنید، یا مقدار را به یک عدد صحیح `round` کنید.

در مرحله قبلی، تعداد روزها بین یک رویداد analytic و ایجاد حساب را با استفاده از عبارت `datetimeDiff` محاسبه کردید. اگر نیاز به آن عدد در هفته‌ها داشتید، می‌توانستید فقط همان عبارت سفارشی `datetimeDiff` را با دوره `"weeks"` استفاده کنید، اما این راه فقط تعداد هفته‌های کامل را می‌دهد. اگر می‌خواهید بدانید حساب 3.5 هفته قدیمی است، می‌توانید تعداد روزها را بر 7 تقسیم کنید:

1. یک ستون سفارشی جدید با کلیک روی **+** در بلوک **Custom column** ایجاد کنید، و در فیلد **Expression**، عبارت را وارد کنید: ```mbql [Days since creation] / 7 ``` اینجا `[Days since creation]` نام ستون سفارشی است که در مرحله قبلی ایجاد کردید (می‌توانید به ستون‌های سفارشی دیگر هنگام تعریف جدید ارجاع دهید).
2. ستون را به عنوان `Weeks since creation` ذخیره کنید و نتایج را پیش‌نمایش کنید. ![هفته‌ها از ایجاد](../../images/custom-columns/weeks-since-creation.png)

[توابع Math](../../../docs/latest/questions/query-builder/expressions-list.html#math-functions) را برای فهرست کامل توابع ریاضی ببینید.

## افزودن منطق if-then

در دو مرحله قبلی، محاسبه کردید حساب چقدر قدیمی است (در هفته‌ها) وقتی یک رویداد اتفاق می‌افتد. بگویید می‌خواهید از این اطلاعات برای نگاه به رویداد برای حساب‌های جدید در مقابل موجود استفاده کنید. برای آن، نیاز به bucket کردن حساب‌ها به "New" یا "Existing" ابتدا بر اساس سن آن‌ها در لحظه رویداد دارید.
در متابیس، دستورات منطقی با استفاده از دستور `case` تعریف می‌شوند (مشابه `CASE` SQL اما متفاوت از صفحه‌گسترده‌ها، جایی که تابع `IF` برای این منظور استفاده می‌شود).

1. یک ستون سفارشی جدید با کلیک روی **+** در بلوک **Custom column** ایجاد کنید، و در فیلد **Expression**، عبارت را وارد کنید: ```mbql case([Weeks since creation] < 52, "New", "Existing") ``` ستون جدید که `"New"` برای رویدادها از حساب‌هایی که کمتر از یک سال (52 هفته) قدیمی هستند دارد، و `"Existing"` در غیر این صورت. بیشتر درباره عبارت `case` [در مستندات ما](../../../docs/latest/questions/query-builder/expressions/case.html) بخوانید.
2. ستون را به عنوان `Account status` ذخیره کنید و نتایج را پیش‌نمایش کنید.

![وضعیت حساب](../../images/custom-columns/account-status.png)

توابع منطقی مفید دیگر: `coalesce`، `isnull`. [توابع Logical](../../../docs/latest/questions/query-builder/expressions-list.html#logical-functions) را برای فهرست کامل توابع منطقی ببینید.

## استفاده از ستون‌های سفارشی برای ساخت پرس‌وجوها و نمودارها

ستون‌های سفارشی دقیقاً مثل ستون‌های جدول کار می‌کنند، پس می‌توانید از آن‌ها در فیلترها، خلاصه‌ها، و برای ساخت نمودارها استفاده کنید.

به عنوان مثال، می‌توانیم به توزیع رویدادهای مختلف در طول روز برای حساب‌های جدید نگاه کنیم.

1. یک فیلتر برای حساب‌های جدید و path URL غیرخالی اضافه کنید نیاز به تغییر عملیات فیلتر از پیش‌فرض "Contains" دارید. ![عملیات فیلتر](../../images/custom-columns/filter-operation.png)
2. رویدادها را برای هر path URL بر اساس ساعت بشمارید. ستون‌های سفارشی باید فقط در بلوک **Group by** ظاهر شوند. ![خلاصه](../../images/custom-columns/summarize.png)
3. تجسم کنید وقتی روی "Visualize" در query builder کلیک می‌کنید، متابیس به طور خودکار یک جدول pivot می‌سازد. برای تجسم بهتر داده الگوهای روزانه، می‌توانید به یک نمودار خط یا area تغییر دهید.

![نمودار نهایی](../../images/custom-columns/final-chart.png)

به هر حال، نمودار در اسکرین‌شات برخی تنظیمات تجسم اضافی روشن دارد تا بهتر به نظر برسد. با تنظیمات سری در تب Data (منوی سه نقطه برای هر سری در تب Data) آزمایش کنید تا ببینید آیا می‌توانید نمودار خود را همان‌طور کنید.

پس چه می‌توانیم درباره رویدادهای حساب جدید بگوییم؟ می‌بینیم که همه رویدادها الگوهای مشابهی را دنبال می‌کنند: بیشتر در صبح و اوایل بعدازظهر trigger می‌شوند با یک dip در طول ناهار. اما بازدیدها به صفحه `/help` یک peak اضافی حدود 7 بعدازظهر دارند.

## مراحل بعدی

عبارات سفارشی می‌توانند برای بیشتر از فقط ستون‌های جدید استفاده شوند – می‌توانید از آن‌ها برای ساخت فیلترها یا خلاصه‌های پیچیده استفاده کنید. آموزش گسترش یافته درباره [عبارات سفارشی](../querying-and-dashboards/questions/custom-expressions.html) را بررسی کنید.

[
      
        

      
      
        
        

      
    ](summarize.html)
[
      
        
        

      
      
        
        

      
    ](dashboard-filters.html)
