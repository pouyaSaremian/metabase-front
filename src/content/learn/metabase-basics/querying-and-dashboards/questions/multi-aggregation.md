---
title: "آموزش: تجمیع چندسطحی"
description: "نحوه پرسیدن سؤال‌ها با چندین بخش با استفاده از query builder."
redirect_from:
  - /learn/metabase-basics/querying-and-dashboards/questions/multi-aggregation
toc:
  - id: "tutorial-multi-level-aggregation"
    title: "آموزش: تجمیع چندسطحی"
    level: 1
    href: "#tutorial-multi-level-aggregation"
breadcrumbs:
  - title: "خانه"
    href: "../../../index.html"
  - title: "پرس‌وجو و داشبوردها"
    href: "../index.html"
  - title: "پرسیدن سؤال‌ها"
    href: "../questions.html"
---

# آموزش: تجمیع چندسطحی

نحوه پرسیدن سؤال‌ها با چندین بخش با استفاده از query builder.

بسیاری از سؤال‌های تحلیل را می‌توان با فقط چهار مرحله پاسخ داد:

1. *Join* کردن چند جدول برای دریافت همه اطلاعات مورد نیاز در یک مکان.
2. *فیلتر* کردن داده تا فقط شامل مقادیری باشد که مرتبط هستند.
3. *Group* و *aggregate* کردن آن مقادیر برای ایجاد بینش مورد نیاز شما.
4. *تجسم* کردن نتیجه تا بتوانید بفهمید داده شما چه می‌گوید.

پرس‌وجوها لازم نیست آنجا متوقف شوند، اگرچه: متابیس به شما اجازه افزودن فیلترهای بیشتر و محاسبه خلاصه‌های بیشتر گام به گام را می‌دهد. برای دیدن نحوه کار این، بیایید مراحل یک تحلیلگر را در حال کاوش اینکه چند مورد از هر دسته به صورت هفتگی فروخته می‌شود ردیابی کنیم.

با شمارش تعداد موارد فروخته شده هر هفته در هر دسته محصول در [پایگاه داده نمونه](../../../../glossary/sample-database.html) شروع می‌کنیم. اطلاعات درباره فروش در جدول `Orders` است، و دسته‌های محصول در جدول `Products` است، پس آن‌ها را با match کردن product IDها join می‌کنیم. برای لحظه می‌خواهیم درباره همه دسته‌های محصول بدانیم، پس نیاز به فیلتر کردن این داده نداریم، اما نیاز به group و خلاصه کردن آن برای محاسبه مجموع‌های هفتگی بر اساس دسته داریم.

![Join کردن سفارش‌ها و محصولات برای آوردن اطلاعات با هم، سپس group و خلاصه کردن برای محاسبه مجموع‌های هفتگی بر اساس دسته.](../../../images/multi-aggregation/join-and-summarize.png)

می‌توانیم نتیجه تا اینجا را به عنوان یک نمودار خطی سری زمانی) تجسم کنیم تا بینشی که قبلاً نداشتیم دریافت کنیم.

![تجسم مجموع‌های هفتگی بر اساس دسته.](../../../images/multi-aggregation/viz-weekly-totals-by-category.png)

با این حال، بیایید بیشتر برویم و یک فیلتر دیگر *بعد از* مرحله خلاصه اضافه کنیم تا widgetها را از داده خود حذف کنیم. وقتی به query builder برمی‌گردیم و دکمه **Add Filter** را در پایین ویرایشگر کلیک می‌کنیم، سه ستون در داده خلاصه شده را به ما نشان می‌دهد: `Created At`، `Category`، و `Count`. چند کلیک به ما اجازه ایجاد یک فیلتر که ردیف‌هایی که دسته آن‌ها widget است را حذف می‌کند می‌دهد.

![تعریف یک فیلتر برای حذف یک دسته از داده خلاصه.](../../../images/multi-aggregation/filter-out-widgets.png)

اگر فیلتر را ذخیره کنیم و داده را تجسم کنیم، یک جدول نتایج دریافت می‌کنیم. اگر نمودار خطی را از تنظیمات تجسم انتخاب کنید، نمودار حالا فقط خطوط برای سه دسته محصول که به آن‌ها علاقه‌مندیم را نشان می‌دهد.

![تجسم مجموع‌های هفتگی فیلتر شده بر اساس دسته.](../../../images/multi-aggregation/viz-filtered-summary.png)

حالا فرض کنید می‌خواهیم میانگین تعداد محصولات از هر یک از این سه دسته که به صورت هفتگی فروخته شدند را بدانیم. از قبل فروش هفتگی بر اساس دسته را محاسبه کرده‌ایم، پس همه آنچه باید انجام دهیم برگشت به query builder، کلیک روی دکمه **Summarize**، انتخاب `Average`، و سپس گفتن به متابیس که می‌خواهیم `Count` را بر اساس `Category` group شده average کنیم.

![افزودن یک مرحله خلاصه دوم برای فشرده‌تر کردن داده حتی بیشتر.](../../../images/multi-aggregation/create-second-summary.png)

تجسم ما حالا دقیقاً آنچه می‌خواهیم است: میانگین تعداد doohickeys، gadgets، و gizmos فروخته شده هر هفته.

![خلاصه نهایی چند عدد کلیدی نشان می‌دهد.](../../../images/multi-aggregation/final-table.png)

سؤال کامل که این جدول را تولید می‌کند:

![تحلیل نهایی هر مرحله را به ترتیب از شروع تا پایان نشان می‌دهد.](../../../images/multi-aggregation/final-analysis.png)

راه‌های دیگری برای محاسبه این نتیجه وجود دارد: می‌توانستیم، به عنوان مثال، widgetها را قبل از محاسبه خلاصه اول حذف کنیم (که بیشتر تحلیلگران آن را یک بهترین روش می‌دانند، چون کاهش اندازه مجموعه داده در ابتدا عملکرد را بهبود می‌دهد). درس مهم این است که می‌توانیم بینش را گام به گام همانطور که هر پاسخ به یک سؤال جدید منجر می‌شود بسازیم، و متابیس به ما اجازه افزودن عملیات یکی یکی همانطور که برای ما رخ می‌دهد را می‌دهد. نیاز به برنامه‌ریزی همه چیز از قبل نداریم: اگر می‌بینیم همیشه با همان عملیات شروع می‌کنیم، می‌توانیم آن‌ها را جداگانه ذخیره کنیم، همانطور که در مقاله [Snippets vs. Saved Questions vs. Views](../sql-in-metabase/organizing-sql.html) توضیح داده شده است.

[
      
        

      
      
        
        

      
    ](cross-db-joins.html)
[
      
        
        

      
      
        
        

      
    ](searching-tables.html)
